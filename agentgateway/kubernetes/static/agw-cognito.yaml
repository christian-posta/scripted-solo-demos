apiVersion: v1
kind: ConfigMap
metadata:
  name: static-agentgateway-config
  namespace: default
data:
  config.yaml: |-
      binds:
      - port: 3000
        listeners:
        - routes:
          - policies:
              cors:
                allowOrigins:
                - "*"
                allowHeaders:
                - "*"
              jwtAuth:
                issuer: https://cognito-idp.us-west-2.amazonaws.com/us-west-2_IgZ5lG7tH
                audiences: [153et88i0stmj4m6ssnjssc127]
                jwks:
                  url: https://cognito-idp.us-west-2.amazonaws.com/us-west-2_IgZ5lG7tH/.well-known/jwks.json
              mcpAuthorization:
                rules:
                # Only the test-user can call 'fetcher'
                - 'jwt["cognito:username"] == "alice" && mcp.tool.target == "fetcher"'
            backends:
            - mcp:
                targets:
                - name: fetcher
                  sse:
                    host: "mcp-website-fetcher.default"
                    port: 80
                    path: "/sse"