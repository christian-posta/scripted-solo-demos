# yaml-language-server: $schema=../../schema/local.json
binds:
- port: 3000
  listeners:
  - routes:
    - policies:
        cors:
          allowOrigins:
          - "*"
          allowHeaders:
          - "*"
          allowMethods:  # Add this!
          - "*"
        requestHeaderModifier:
          remove:
          - x-forwarded-for
          - x-forwarded-host
          - x-forwarded-proto          
        backendTLS: {}
        mcpAuthentication:
          issuer: https://ceposta-solo.auth0.com/
          jwksUrl: https://ceposta-solo.auth0.com/.well-known/jwks.json
          audience: https://ceposta-agw.ngrok.io/mcp
          provider:
            auth0: {}
          resourceMetadata:
            authorizationServers:
            - https://ceposta-agw.ngrok.io/mcp          
            resource: https://ceposta-agw.ngrok.io/mcp
            scopesSupported:
            - profile
            - openid
            - offline_access
            bearerMethodsSupported:
            - header
            - body
            - query
            resourceDocumentation: https://ceposta-agw.ngrok.io/docs
            resourcePolicyUri: https://ceposta-agw.ngrok.io/policies   
      matches:
      - path:
          exact: /mcp
      - path:
          exact: /.well-known/oauth-protected-resource/mcp
      - path:
          exact: /.well-known/oauth-authorization-server/mcp                 
      backends:
      - mcp:
          targets:
          - name: deepwiki
            mcp:
              host: "mcp.deepwiki.com"
              port: 443
              path: "/mcp"
          - name: microsoft
            mcp:
              host: "learn.microsoft.com"
              port: 443
              path: "/api/mcp"                            
                       
