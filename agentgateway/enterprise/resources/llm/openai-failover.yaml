apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: openai-failover
  namespace: enterprise-agentgateway
spec:
  parentRefs:
    - name: agentgateway
      namespace: enterprise-agentgateway
  rules:
    - matches:
        - path:
            type: PathPrefix
            value: /failover/openai
      backendRefs:
        - name: openai-failover
          group: agentgateway.dev
          kind: AgentgatewayBackend
      timeouts:
        request: "120s"
---
apiVersion: agentgateway.dev/v1alpha1
kind: AgentgatewayBackend
metadata:
  name: openai-failover
  namespace: enterprise-agentgateway
spec:
  ai:
    groups:
      # priority group 1
      - providers:
          - name: primary-model
            openai:
              model: gpt-5
            host: failover-429.enterprise-agentgateway.svc.cluster.local
            port: 9959
      # priority group 2
      - providers:
          - name: secondary-model
            openai:
              model: gpt-4o
            policies:
              auth:
                secretRef:
                  name: openai-secret


